---
import { getCollection } from 'astro:content';
import Page from '../../layouts/Page.astro';

// Generate static paths for all patterns
export async function getStaticPaths() {
  const patterns = await getCollection('patterns');

  return patterns.map((entry) => ({
    params: { id: entry.slug },
    props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content } = await entry.render();
const { title, category, tags, date } = entry.data;

// Create meta description from title
const description = `Understanding ${title.toLowerCase()}: benefits, trade-offs, implementation, and when to use this content delivery pattern.`;
---

<Page title={title} description={description}>
	<article class="section pattern-content">
		<header class="pattern-header">
			<p class="text-secondary text-small">{category}</p>
			<div class="pattern-tags">
				{tags.map((tag) => (
					<span class="tag">{tag}</span>
				))}
			</div>
		</header>

		<Content />

		<footer class="pattern-footer">
			<hr />
			<p class="text-secondary text-small">
				Published: <time datetime={date.toISOString()}>{date.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</time>
			</p>
			<p>
				<a href="/">‚Üê Back to Home</a>
			</p>
		</footer>
	</article>
</Page>

<style>
	.pattern-content {
		max-width: 70ch;
		margin-inline: auto;
	}

	.pattern-header {
		margin-block-end: var(--space-8);
	}

	.pattern-tags {
		display: flex;
		gap: var(--space-2);
		flex-wrap: wrap;
		margin-block-start: var(--space-3);
	}

	.tag {
		display: inline-block;
		padding: var(--space-1) var(--space-3);
		background: var(--color-surface-secondary);
		border-radius: var(--radius-sm);
		font-size: var(--font-size-sm);
		color: var(--color-text-secondary);
	}

	.pattern-footer {
		margin-block-start: var(--space-12);
		padding-block-start: var(--space-6);
	}

	.pattern-footer hr {
		margin-block-end: var(--space-6);
	}

	/* Markdown content styling */
	.pattern-content :global(h2) {
		margin-block-start: var(--space-10);
		margin-block-end: var(--space-4);
		font-size: var(--font-size-xl);
	}

	.pattern-content :global(h3) {
		margin-block-start: var(--space-8);
		margin-block-end: var(--space-3);
		font-size: var(--font-size-lg);
	}

	.pattern-content :global(p) {
		margin-block-end: var(--space-4);
		line-height: var(--line-height-relaxed);
	}

	.pattern-content :global(ul),
	.pattern-content :global(ol) {
		margin-block-end: var(--space-4);
		padding-inline-start: var(--space-6);
	}

	.pattern-content :global(li) {
		margin-block-end: var(--space-2);
		line-height: var(--line-height-relaxed);
	}

	.pattern-content :global(code) {
		font-family: var(--font-mono);
		font-size: 0.9em;
		background: var(--color-surface-secondary);
		padding: 0.2em 0.4em;
		border-radius: var(--radius-sm);
	}

	.pattern-content :global(pre) {
		margin-block: var(--space-6);
		padding: var(--space-4);
		background: var(--color-surface-secondary);
		border-radius: var(--radius-md);
		overflow-x: auto;
		line-height: var(--line-height-normal);
	}

	.pattern-content :global(pre code) {
		background: none;
		padding: 0;
	}

	.pattern-content :global(blockquote) {
		margin-block: var(--space-6);
		padding-inline-start: var(--space-4);
		border-inline-start: 4px solid var(--color-primary);
		color: var(--color-text-secondary);
		font-style: italic;
	}

	.pattern-content :global(a) {
		color: var(--color-primary);
		text-decoration: underline;
		text-decoration-thickness: 1px;
		text-underline-offset: 2px;
	}

	.pattern-content :global(a:hover) {
		text-decoration-thickness: 2px;
	}

	.pattern-content :global(strong) {
		font-weight: 600;
	}

	.pattern-content :global(hr) {
		margin-block: var(--space-8);
		border: none;
		border-top: 1px solid var(--color-border);
	}
</style>
